app:
  fullnameOverride: sample-node

  image:
    # repository: 082867736673.dkr.ecr.ap-northeast-2.amazonaws.com/nalbam/sample-node
    repository: nalbam/sample-node

  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 250m
      memory: 256Mi

  controller:
    kind: Rollout
    strategy:
      # rollingUpdate:
      #   maxSurge: 25%
      #   maxUnavailable: 0
      canary:
        canaryService: sample-node-preview
        stableService: sample-node-stable
        steps:
        - setWeight: 10
        # - setCanaryScale:
        #     replicas: 1
        - pause:
            duration: 10
        - analysis:
            args:
            - name: url
              value: http://sample-node-preview/success/98
            templates:
            - clusterScope: true
              templateName: http-benchmark
        - setWeight: 25
        # - setCanaryScale:
        #     matchTrafficWeight: true
        - pause:
            duration: 10
        - setWeight: 50
        - pause:
            duration: 10
        - setWeight: 75
        - pause:
            duration: 10

  service:
    name: http
    targetPort: 3000

  readinessProbe:
    failureThreshold: 3
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 3
    periodSeconds: 3

  livenessProbe:
    failureThreshold: 3
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 3
    periodSeconds: 3

redis:
  fullnameOverride: sample-redis

  image:
    repository: redis
    tag: alpine

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

  service:
    name: redis
    port: 6379
    targetPort: 6379
